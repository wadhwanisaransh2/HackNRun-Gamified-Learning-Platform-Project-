<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Black Hole Learning Game</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
/* Global Styles */
body {
    margin: 0;
    background: #0d0d1a;
    overflow: hidden;
    font-family: 'Orbitron', sans-serif;
    color: #b3cde0;
    cursor: grab;
}

canvas {
    display: block;
    background: #0d0d1a;
}

/* UI Elements */
.game-ui {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    flex-direction: column;
    z-index: 1;
    font-size: 1.2rem;
    background: rgba(17, 34, 51, 0.4);
    backdrop-filter: blur(5px);
    border-radius: 12px;
    padding: 15px;
    border: 2px solid #5a85b1;
    box-shadow: 0 0 15px rgba(90, 133, 177, 0.5);
    min-width: 150px;
}
#score, #level, #stars-counter {
    text-shadow: 0 0 5px #fff, 0 0 10px #b3cde0;
    color: #e6f2ff;
}

/* Overlay for all menus (MCQ, Game Over, etc.) */
.overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
    color: #e6f2ff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    padding: 20px;
    text-align: center;
    line-height: 1.5;
}

.overlay h2, .overlay h3 {
    text-shadow: 0 0 10px #86b2d6;
    margin-bottom: 20px;
}

.overlay form div {
    margin-bottom: 15px;
    text-align: left;
}
.overlay input[type="radio"] {
    accent-color: #86b2d6;
    margin-right: 8px;
}
.overlay button {
    padding: 12px 25px;
    font-size: 1rem;
    font-family: 'Orbitron', sans-serif;
    color: #e6f2ff;
    background: #1a4f8a;
    border: 2px solid #5a85b1;
    border-radius: 8px;
    text-shadow: 0 0 5px #fff;
    box-shadow: 0 0 10px #1a4f8a;
    transition: background-color 0.3s, box-shadow 0.3s, transform 0.1s;
    cursor: pointer;
}
.overlay button:hover {
    background: #2566b8;
    box-shadow: 0 0 15px #2566b8;
    transform: translateY(-2px);
}
.overlay button:active {
    transform: translateY(0);
}
#mcq-feedback {
    margin-top: 20px;
    color: #ff9900;
    font-weight: bold;
}

/* Game Over Modal */
#game-over-modal h3, #level-complete-modal h3 {
    font-size: 2rem;
    color: #ff3333;
    text-shadow: 0 0 15px #ff6666;
}
#game-over-modal p, #level-complete-modal p {
    font-size: 1.2rem;
    margin-top: 10px;
}
#game-over-modal #restart-btn, #level-complete-modal #next-level-btn {
    margin-top: 25px;
}

/* Educational Fact Modal */
#educational-fact-modal h3 {
    color: #86b2d6;
}
#educational-fact-modal p {
    max-width: 600px;
}
</style>
</head>
<body>

<div class="game-ui">
    <div id="score">Score: 0</div>
    <div id="level">Level: 1</div>
    <div id="stars-counter">Stars: 0/5</div>
</div>

<!-- Initial MCQ Overlay -->
<div id="mcq-overlay" class="overlay">
    <h2>Welcome, Traveler!</h2>
    <h3>Answer these questions to calibrate your ship's cognitive matrix.</h3>
    <form id="mcq-form">
        <div>
            <p>1. What is a black hole?</p>
            <input type="radio" name="q1" value="a"> A star<br>
            <input type="radio" name="q1" value="b"> A region of space with strong gravity<br>
            <input type="radio" name="q1" value="c"> A planet<br>
        </div>
        <div>
            <p>2. What is the event horizon?</p>
            <input type="radio" name="q2" value="a"> The surface of a planet<br>
            <input type="radio" name="q2" value="b"> The boundary around a black hole beyond which nothing can escape<br>
            <input type="radio" name="q2" value="c"> A type of star<br>
        </div>
        <div>
            <p>3. Gravity is:</p>
            <input type="radio" name="q3" value="a"> A force that pulls objects together<br>
            <input type="radio" name="q3" value="b"> A kind of light<br>
            <input type="radio" name="q3" value="c"> A planet<br>
        </div>
        <button type="submit">Begin Mission</button>
    </form>
    <p id="mcq-feedback"></p>
</div>

<!-- Game Over Modal -->
<div id="game-over-modal" class="overlay" style="display: none;">
    <h3>MISSION FAILED</h3>
    <p>Your ship was consumed by the void. Final Score: <span id="final-score">0</span></p>
    <button id="restart-btn">Restart</button>
</div>

<!-- Level Complete Modal -->
<div id="level-complete-modal" class="overlay" style="display: none;">
    <h3>LEVEL COMPLETE</h3>
    <p>You have successfully navigated this sector.</p>
    <button id="next-level-btn">Next Level</button>
</div>

<!-- Educational Fact Modal -->
<div id="educational-fact-modal" class="overlay" style="display: none;">
    <h3 id="fact-title"></h3>
    <p id="fact-text"></p>
    <button id="continue-btn">Continue</button>
</div>

<canvas id="canvas"></canvas>

<script>
// Canvas and UI setup
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('score');
const levelDisplay = document.getElementById('level');
const starsCounterDisplay = document.getElementById('stars-counter');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

// Game variables
let score = 0;
let level = 1;
let starsCollected = 0;
let starsToPassLevel = 5;
let gameIsRunning = false;
let isShieldActive = false;
let shieldTimer = null;

// Educational Facts
const educationalFacts = [
    "Did you know? The first image of a black hole was captured in 2019 by the Event Horizon Telescope!",
    "The 'spaghettification' effect is the process where an object is stretched and torn apart by the immense tidal forces of a black hole.",
    "The 'event horizon' is the point of no return. Once something crosses it, not even light can escape the black hole's gravity.",
    "Black holes are formed from the collapse of massive stars, at least 20 times the mass of our sun.",
    "The closest known black hole to Earth is Gaia BH1, located about 1,560 light-years away in the constellation Ophiuchus."
];

// ---------- CLASSES ----------

// Represents a light ray bending around a massive object
class LightRay {
    constructor(x, y, angle) {
        this.x = x;
        this.y = y;
        this.angle = angle;
        this.path = [{ x: this.x, y: this.y }];
    }
    update(massiveObjects) {
        for (let obj of massiveObjects) {
            let dx = obj.x - this.x, dy = obj.y - this.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 300) {
                let targetAngle = Math.atan2(dy, dx);
                this.angle += (targetAngle - this.angle) * 0.08;
            }
        }
        this.x += Math.cos(this.angle) * 3;
        this.y += Math.sin(this.angle) * 3;
        this.path.push({ x: this.x, y: this.y });
        if (this.path.length > 200) this.path.shift();
    }
    draw(ctx) {
        for (let i = 0; i < this.path.length - 1; i++) {
            let p1 = this.path[i], p2 = this.path[i + 1];
            let alpha = i / this.path.length;
            let distToBH = Math.sqrt((p1.x - blackHole.x) ** 2 + (p1.y - blackHole.y) ** 2);
            let glow = Math.min(1, 300 / distToBH);
            ctx.strokeStyle = `rgba(${Math.floor(255 * glow)},${Math.floor(255 * glow)},${Math.floor(255 * glow)},${alpha})`;
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
        }
    }
}

// Represents the Black Hole
class MassiveObject {
    constructor(x, y, mass) {
        this.x = x;
        this.y = y;
        this.mass = mass;
        this.radius = 30;
    }
    draw(ctx) {
        const gradient = ctx.createRadialGradient(this.x, this.y, this.radius, this.x, this.y, this.radius * 4);
        gradient.addColorStop(0, 'orange');
        gradient.addColorStop(0.5, 'red');
        gradient.addColorStop(1, 'transparent');
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius * 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = 'black';
        ctx.fill();
        ctx.strokeStyle = '#e6f2ff';
        ctx.lineWidth = 2;
        ctx.stroke();
    }
}

// Represents the Player's Spaceship
class Spaceship {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = 20;
        this.bullets = [];
        this.angle = 0;
    }
    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle + Math.PI / 2);

        // Body
        ctx.fillStyle = '#b3cde0';
        ctx.beginPath();
        ctx.moveTo(0, -this.size);
        ctx.lineTo(this.size / 2, this.size);
        ctx.lineTo(0, this.size * 0.6);
        ctx.lineTo(-this.size / 2, this.size);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#e6f2ff';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Thruster
        if (keys['ArrowUp'] || keys['w']) {
            ctx.fillStyle = `rgba(255, 153, 0, ${0.8 + Math.random() * 0.2})`;
            ctx.beginPath();
            ctx.moveTo(-this.size / 4, this.size);
            ctx.lineTo(this.size / 4, this.size);
            ctx.lineTo(0, this.size + 10 + Math.random() * 10);
            ctx.closePath();
            ctx.fill();
        }

        if (isShieldActive) {
            ctx.beginPath();
            ctx.arc(0, 0, this.size * 2, 0, Math.PI * 2);
            ctx.strokeStyle = 'cyan';
            ctx.lineWidth = 3;
            ctx.stroke();
            const shieldGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size * 2);
            shieldGradient.addColorStop(0, 'rgba(0, 255, 255, 0.4)');
            shieldGradient.addColorStop(1, 'rgba(0, 255, 255, 0)');
            ctx.fillStyle = shieldGradient;
            ctx.fill();
        }

        ctx.restore();
    }
    move(dirX, dirY) {
        this.x += dirX;
        this.y += dirY;
        this.x = Math.max(this.size, Math.min(canvas.width - this.size, this.x));
        this.y = Math.max(this.size, Math.min(canvas.height - this.size, this.y));
    }
    shoot() {
        this.bullets.push(new Bullet(this.x, this.y, this.angle, 6));
    }
}

// Represents a Bullet
class Bullet {
    constructor(x, y, angle, speed) {
        this.x = x;
        this.y = y;
        this.angle = angle;
        this.speed = speed;
    }
    update(massiveObjects) {
        for (let obj of massiveObjects) {
            let dx = obj.x - this.x, dy = obj.y - this.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 300) {
                let targetAngle = Math.atan2(dy, dx);
                this.angle += (targetAngle - this.angle) * 0.08;
            }
        }
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;
    }
    draw(ctx) {
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
        ctx.fill();
    }
}

// Represents an Asteroid
class Asteroid {
    constructor(x, y, speed) {
        this.x = x;
        this.y = y;
        this.size = 15;
        this.speed = speed;
    }
    update() {
        this.y += this.speed;
    }
    draw(ctx) {
        ctx.fillStyle = '#ff6666';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

// Represents a Collectible Star
class Star {
    constructor(x, y, type = 'star') {
        this.x = x;
        this.y = y;
        this.radius = 6;
        this.type = type; // 'star' or 'shield'
    }
    draw(ctx) {
        if (this.type === 'star') {
            ctx.fillStyle = '#ffcc00';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fill();
        } else if (this.type === 'shield') {
            ctx.fillStyle = '#00aaff';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius * 1.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'cyan';
            ctx.font = '12px Orbitron';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('S', this.x, this.y);
        }
    }
}

// Represents a particle for visual effects
class Particle {
    constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.size = Math.random() * 5 + 1;
        this.speedX = (Math.random() - 0.5) * 2;
        this.speedY = (Math.random() - 0.5) * 2;
        this.lifespan = 100;
        this.opacity = 1;
    }
    update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.lifespan--;
        this.opacity = this.lifespan / 100;
    }
    draw(ctx) {
        ctx.save();
        ctx.globalAlpha = this.opacity;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

// ---------- INITIALIZATION ----------
const lightRays = [];
const blackHole = new MassiveObject(canvas.width / 2, canvas.height / 2, 12000);
const massiveObjects = [blackHole];
const spaceship = new Spaceship(150, canvas.height / 2);
const asteroids = [];
const stars = [];
const particles = [];

// Event listeners for key controls
let keys = {};
window.addEventListener('keydown', e => {
    keys[e.key] = true;
    if (e.key === ' ' && gameIsRunning) spaceship.shoot();
});
window.addEventListener('keyup', e => keys[e.key] = false);

// Event listeners for drag black hole
let dragging = null;
canvas.addEventListener('mousedown', (e) => {
    const mx = e.clientX, my = e.clientY;
    for (let obj of massiveObjects) {
        let dx = obj.x - mx, dy = obj.y - my;
        if (Math.sqrt(dx * dx + dy * dy) < obj.radius * 4) {
            dragging = obj;
            document.body.style.cursor = 'grabbing';
        }
    }
});
canvas.addEventListener('mousemove', (e) => {
    if (dragging) {
        dragging.x = e.clientX;
        dragging.y = e.clientY;
    }
});
canvas.addEventListener('mouseup', () => {
    dragging = null;
    document.body.style.cursor = 'grab';
});
canvas.addEventListener('mouseleave', () => {
    dragging = null;
    document.body.style.cursor = 'grab';
});

// Event listeners for UI buttons
document.getElementById('restart-btn').addEventListener('click', () => window.location.reload());
document.getElementById('next-level-btn').addEventListener('click', () => {
    document.getElementById('level-complete-modal').style.display = 'none';
    startNextLevel();
});
document.getElementById('continue-btn').addEventListener('click', () => {
    document.getElementById('educational-fact-modal').style.display = 'none';
    startGameLoop();
});

// ---------- MCQ HANDLING ----------
const mcqForm = document.getElementById('mcq-form');
const mcqOverlay = document.getElementById('mcq-overlay');
const mcqFeedback = document.getElementById('mcq-feedback');
mcqForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const answers = { q1: 'b', q2: 'b', q3: 'a' };
    let correct = 0;
    for (let q in answers) {
        if (mcqForm.elements[q].value === answers[q]) correct++;
    }
    if (correct === 3) {
        mcqOverlay.style.display = 'none';
        startGameLoop();
    } else {
        mcqFeedback.textContent = `You got ${correct} correct. Try again!`;
    }
});

// ---------- GAME FUNCTIONS ----------

// Starts the game loop
function startGameLoop() {
    gameIsRunning = true;
    animate();
}

// Spawns stars and power-ups for the level
function spawnStars() {
    stars.length = 0; // Clear existing stars
    const shieldSpawnChance = level > 1 ? 0.2 : 0; // Higher chance in later levels
    for (let i = 0; i < starsToPassLevel; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * (canvas.height / 2);
        if (Math.random() < shieldSpawnChance) {
            stars.push(new Star(x, y, 'shield'));
        } else {
            stars.push(new Star(x, y, 'star'));
        }
    }
    starsCollected = 0;
    starsCounterDisplay.textContent = `Stars: ${starsCollected}/${starsToPassLevel}`;
}

// Function to start a new level
function startNextLevel() {
    gameIsRunning = false;
    level++;
    starsToPassLevel += 2; // Increase stars needed to pass level
    
    // Show educational fact
    const randomFact = educationalFacts[Math.floor(Math.random() * educationalFacts.length)];
    document.getElementById('fact-title').textContent = `LEVEL ${level-1} COMPLETE!`;
    document.getElementById('fact-text').textContent = randomFact;
    document.getElementById('educational-fact-modal').style.display = 'flex';
    levelDisplay.textContent = `Level: ${level}`;

    // Reset game state for new level
    asteroids.length = 0;
    particles.length = 0;
    spaceship.bullets.length = 0;
    spaceship.x = 150;
    spaceship.y = canvas.height / 2;
    blackHole.x = canvas.width / 2;
    blackHole.y = canvas.height / 2;
    spawnStars();
}

// Game over modal
function showGameOver() {
    gameIsRunning = false;
    document.getElementById('final-score').textContent = score;
    document.getElementById('game-over-modal').style.display = 'flex';
}

// Spawns asteroids periodically, increasing frequency with level
setInterval(() => {
    if (!gameIsRunning) return;
    const asteroidSpeed = 2 + (level - 1) * 0.5;
    const asteroidSpawnRate = 2000 - (level - 1) * 100;
    asteroids.push(new Asteroid(Math.random() * canvas.width, -20, asteroidSpeed + Math.random()));
}, 2000);

// Apply gravitational pull to an object
function applyGravity(obj) {
    let dx = blackHole.x - obj.x;
    let dy = blackHole.y - obj.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < 250) {
        let pullStrength = 3 * (1 - dist / 250);
        obj.x += (dx / dist) * pullStrength;
        obj.y += (dy / dist) * pullStrength;
    }
}

// Visual warp effect around the black hole
function warpEffect() {
    let warpRadius = 120;
    for (let i = 0; i < canvas.width; i += 12) {
        for (let j = 0; j < canvas.height; j += 12) {
            let dx = i - blackHole.x;
            let dy = j - blackHole.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < warpRadius) {
                let factor = 1 - dist / warpRadius;
                ctx.fillStyle = `rgba(134, 178, 214, ${factor * 0.05})`;
                ctx.fillRect(i, j, 12, 12);
            }
        }
    }
}

// ---------- GAME LOOP ----------
function animate() {
    if (!gameIsRunning) {
        requestAnimationFrame(animate);
        return;
    }

    ctx.fillStyle = 'rgba(13, 13, 26, 0.1)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Apply gravity to all objects
    applyGravity(spaceship);
    asteroids.forEach(a => applyGravity(a));
    stars.forEach(s => applyGravity(s));
    spaceship.bullets.forEach(b => applyGravity(b));

    // Warp visual effect
    warpEffect();

    // Move spaceship & angle
    let moveX = 0, moveY = 0;
    let speed = 4;
    if (keys['ArrowUp'] || keys['w']) moveY -= 1;
    if (keys['ArrowDown'] || keys['s']) moveY += 1;
    if (keys['ArrowLeft'] || keys['a']) moveX -= 1;
    if (keys['ArrowRight'] || keys['d']) moveX += 1;
    if (moveX !== 0 || moveY !== 0) {
        spaceship.angle = Math.atan2(moveY, moveX);
        spaceship.move(moveX * speed, moveY * speed);
    }

    // Light rays
    for (let ray of lightRays) {
        ray.update(massiveObjects);
        ray.draw(ctx);
    }

    // Black hole
    for (let obj of massiveObjects) obj.draw(ctx);

    // Spaceship
    spaceship.draw(ctx);

    // Bullets
    for (let i = spaceship.bullets.length - 1; i >= 0; i--) {
        let b = spaceship.bullets[i];
        b.update(massiveObjects);
        b.draw(ctx);
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
            spaceship.bullets.splice(i, 1);
        }
    }

    // Asteroids
    for (let i = asteroids.length - 1; i >= 0; i--) {
        let a = asteroids[i];
        a.update();
        a.draw(ctx);

        // Asteroid collision with spaceship
        let dx = a.x - spaceship.x, dy = a.y - spaceship.y;
        if (Math.sqrt(dx * dx + dy * dy) < a.size + spaceship.size && !isShieldActive) {
            showGameOver();
            return; // Stop the animation loop
        }

        // Asteroid collision with bullet
        for (let j = spaceship.bullets.length - 1; j >= 0; j--) {
            let b = spaceship.bullets[j];
            let dx2 = b.x - a.x, dy2 = b.y - a.y;
            if (Math.sqrt(dx2 * dx2 + dy2 * dy2) < a.size + 4) {
                // Add particle effect for explosion
                for (let k = 0; k < 10; k++) {
                    particles.push(new Particle(a.x, a.y, 'red'));
                }
                asteroids.splice(i, 1);
                spaceship.bullets.splice(j, 1);
                score += 20;
                scoreDisplay.textContent = `Score: ${score}`;
                break;
            }
        }
        if (a.y > canvas.height + 20) asteroids.splice(i, 1);
    }

    // Stars
    for (let i = stars.length - 1; i >= 0; i--) {
        let s = stars[i];
        s.draw(ctx);
        let dx = s.x - spaceship.x, dy = s.y - spaceship.y;
        if (Math.sqrt(dx * dx + dy * dy) < s.radius + spaceship.size) {
            if (s.type === 'star') {
                score += 10;
                starsCollected++;
                starsCounterDisplay.textContent = `Stars: ${starsCollected}/${starsToPassLevel}`;
                for (let k = 0; k < 5; k++) particles.push(new Particle(s.x, s.y, '#ffcc00'));
            } else if (s.type === 'shield') {
                isShieldActive = true;
                if (shieldTimer) clearTimeout(shieldTimer);
                shieldTimer = setTimeout(() => {
                    isShieldActive = false;
                }, 8000);
                for (let k = 0; k < 5; k++) particles.push(new Particle(s.x, s.y, 'cyan'));
            }
            stars.splice(i, 1);
            scoreDisplay.textContent = `Score: ${score}`;
            if (starsCollected >= starsToPassLevel) {
                document.getElementById('level-complete-modal').style.display = 'flex';
                gameIsRunning = false;
            }
        }
    }
    
    // Particles
    for (let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i];
        p.update();
        p.draw(ctx);
        if (p.lifespan <= 0) {
            particles.splice(i, 1);
        }
    }

    requestAnimationFrame(animate);
}

// Initial setup
for (let i = 0; i < 120; i++) lightRays.push(new LightRay(50, canvas.height / 2 + i * 4 - 240, 0));
spawnStars();
</script>

</body>
</html>
